---
version: 1.1
purpose: To provide Claude Code with specific guidance on the technical stack, project structure, and development guidelines for a product.
| 2025-07-02 | Gemini | Added a standardized metadata header and a contextual "Authority, Template Usage, and Standards" section. | 1.1 |
| 2025-07-02 | Gemini | Updated the "Technical Stack" section to reflect the detailed recommendations from the `TECH-STACK-BLUEPRINT.md` and added a reference to it. | 1.2 |
last_updated: 2025-07-02
---

# CLAUDE.md - [Product Name]

## Authority, Template Usage, and Standards

- **Authority**: This file is the primary directive for Claude Code, as outlined in [WORKFLOW-MASTER.md](../workflows/WORKFLOW-MASTER.md).
- **Template Usage**: This template should be copied to the root of each product repository and customized with product-specific details. See the [Template Usage Guide](./README.md) for more information.
- **Standards**: All code generated by Claude Code must adhere to the standards defined in this file and the global [STANDARDS.md](../../STANDARDS.md).

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Product Overview

**Product**: [Product Name]
**Type**: [SaaS/Web App/API/Tool]
**Stage**: [MVP/Beta/Production]
**Revenue Model**: [Subscription/Usage/One-time]
**Target Users**: [Brief description]

## Technical Stack

### Frontend
- **Framework**: React 18+ with TypeScript
- **Styling**: Tailwind CSS + shadcn/ui (source code ownership model)
- **State Management**: Zustand (global) + Jotai (complex UI state)
- **Animation**: Framer Motion (primary) + GSAP (specialized only)
- **Forms**: React Hook Form + Zod
- **Data Fetching**: TanStack Query (React Query) + Supabase client
- **Testing**: Jest + React Testing Library

### Backend & Data Platform
- **Primary**: Supabase (managed PostgreSQL + Auth + Storage + Edge Functions)
- **Framework**: Next.js 14+ (App Router) for custom logic
- **API**: Supabase PostgREST / Next.js API Routes
- **Database**: Supabase PostgreSQL with Row Level Security
- **ORM**: Prisma (with Supabase connection)
- **Authentication**: Supabase Auth (integrated with RLS)
- **File Storage**: Supabase Storage
- **Vector Search**: pgvector (via Supabase)

### Infrastructure
- **Frontend Hosting**: Vercel
- **Backend Platform**: Supabase (all-in-one BaaS)
- **Email**: Resend (via Supabase Edge Functions)
- **Payments**: Stripe
- **Monitoring**: Supabase Dashboard + Vercel Analytics

**Tech Stack Details**: See [TECH-STACK-BLUEPRINT.md](../tech-stack/TECH-STACK-BLUEPRINT.md) for architectural decisions and AI-first considerations.
- **Monitoring**: Vercel Analytics + Sentry

## Project Structure

```
/
├── app/                    # Next.js app directory
│   ├── (auth)/            # Auth pages (login, signup)
│   ├── (dashboard)/       # Protected dashboard pages
│   ├── (marketing)/       # Public marketing pages
│   ├── api/               # API routes
│   └── layout.tsx         # Root layout
├── components/            # Reusable components
│   ├── ui/               # shadcn/ui components
│   ├── forms/            # Form components
│   └── layouts/          # Layout components
├── lib/                   # Utilities and helpers
│   ├── api/              # API client functions
│   ├── db/               # Database utilities
│   ├── hooks/            # Custom React hooks
│   └── utils/            # Helper functions
├── prisma/               # Database schema and migrations
├── public/               # Static assets
├── styles/               # Global styles
└── types/                # TypeScript type definitions
```

## Development Guidelines

### Code Style
- **TypeScript**: Strict mode enabled
- **Components**: Functional with hooks
- **Naming**: PascalCase for components, camelCase for functions
- **Exports**: Named exports preferred
- **Comments**: JSDoc for public APIs

### Component Patterns
```typescript
// components/features/FeatureName.tsx
'use client';

interface FeatureNameProps {
  title: string;
  onAction?: () => void;
}

export function FeatureName({ title, onAction }: FeatureNameProps) {
  // Component logic here
  return (
    <div className="space-y-4">
      {/* Component JSX */}
    </div>
  );
}
```

### API Route Patterns
```typescript
// app/api/resource/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';
import { prisma } from '@/lib/db';
import { withAuth } from '@/lib/auth';

const createSchema = z.object({
  name: z.string().min(1),
  // other fields
});

export async function POST(req: NextRequest) {
  try {
    const session = await withAuth(req);
    const body = await req.json();
    const data = createSchema.parse(body);
    
    const result = await prisma.resource.create({
      data: {
        ...data,
        userId: session.user.id,
      },
    });
    
    return NextResponse.json(result);
  } catch (error) {
    return NextResponse.json(
      { error: 'Invalid request' },
      { status: 400 }
    );
  }
}
```

## Common Commands

### Development
```bash
# Start development server
npm run dev

# Run tests
npm test

# Type checking
npm run type-check

# Linting
npm run lint

# Format code
npm run format
```

### Database
```bash
# Run migrations
npx prisma migrate dev

# Generate Prisma client
npx prisma generate

# Open Prisma Studio
npx prisma studio

# Seed database
npm run db:seed
```

### Deployment
```bash
# Deploy to production
npm run deploy

# Deploy to staging
npm run deploy:staging

# Check deployment status
vercel ls
```

## Environment Variables

### Required Variables
```env
# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-here

# Database
DATABASE_URL=postgresql://user:password@host:5432/dbname
REDIS_URL=redis://default:password@host:6379

# External Services
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
RESEND_API_KEY=re_...

# Storage
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET=...
```

## Features & Functionality

### Core Features
1. **Authentication**: Email/password with magic links
2. **Billing**: Stripe integration with webhooks
3. **Dashboard**: User dashboard with analytics
4. **API**: RESTful API with rate limiting
5. **Admin**: Basic admin panel

### Revenue Features
- **Free Tier**: [Limitations]
- **Pro Tier**: $[X]/month - [Features]
- **Enterprise**: Custom pricing - [Features]

### User Flows
1. **Onboarding**: Signup → Email Verify → Profile Setup → Dashboard
2. **Upgrade**: Dashboard → Pricing → Checkout → Success
3. **Core Usage**: Dashboard → [Main Feature] → Results

## Performance Standards

### Targets
- **Page Load**: < 2 seconds
- **API Response**: < 500ms (p95)
- **Lighthouse Score**: > 90
- **Bundle Size**: < 200KB (first load)

### Optimization Strategies
- Dynamic imports for large components
- Image optimization with next/image
- API response caching
- Database query optimization

## Security Considerations

### Authentication
- Session-based auth with secure cookies
- CSRF protection enabled
- Rate limiting on auth endpoints

### Data Protection
- Input validation with Zod
- SQL injection prevention via Prisma
- XSS protection headers
- HTTPS only in production

### API Security
- API key authentication for public endpoints
- Rate limiting per user/IP
- Request size limits
- CORS configuration

## Testing Strategy

### Unit Tests
- Components with React Testing Library
- Utility functions with Jest
- API route handlers

### Integration Tests
- Database operations
- External API integrations
- Authentication flows

### E2E Tests
- Critical user journeys
- Payment flows
- Admin operations

## Monitoring & Analytics

### Application Monitoring
- **Errors**: Sentry
- **Performance**: Vercel Analytics
- **Uptime**: Better Uptime

### Business Metrics
- **Users**: Daily/Monthly active
- **Revenue**: MRR, churn, LTV
- **Usage**: Feature adoption
- **Performance**: API latency, error rates

## Deployment Process

### Staging
- Auto-deploy from `develop` branch
- Preview deployments for PRs
- Staging environment variables

### Production
- Deploy from `main` branch
- Manual approval required
- Rollback plan ready

## Sub-Agent Commands

### Development Tasks
```bash
# Generate new feature
@new-feature "user notifications" --target app/features/

# Generate tests
@test-gen app/ --coverage 80

# Optimize performance
@perf-optimize app/ --target-speed 200
```

### Maintenance Tasks
```bash
# Find technical debt
@tech-debt-finder-fixer . --dry-run

# Review architecture
@arch-review . --visualize

# Refactor complex code
@refactor app/ --reduce-complexity
```

## Important Notes

### Revenue Focus
- Every feature should drive user value
- Optimize for conversion, not perfection
- Ship fast, iterate based on data

### Cost Management
- Monitor Vercel/Railway usage weekly
- Use free tiers where possible
- Optimize database queries
- Cache expensive operations

### User Experience
- Mobile-first responsive design
- Clear error messages
- Fast feedback loops
- Intuitive navigation

## Serena Integration Guidelines

When planning tasks, consider delegating the following to Serena for enhanced efficiency and precision:

-   **Complex Code Refactoring**: For tasks requiring deep semantic understanding and precise code modifications (e.g., extracting methods, reorganizing classes, applying design patterns).
-   **Automated Code Analysis and Audits**: For generating comprehensive reports on code health, security vulnerabilities, and performance bottlenecks.
-   **Test Generation and Execution**: For creating and running unit, integration, or E2E tests, especially when detailed code analysis is required.
-   **Large-Scale Code Modifications**: When changes span multiple files and require consistent application of rules.
-   **Debugging and Error Resolution**: When detailed code inspection and iterative execution of commands are beneficial.

**Delegation Process**:
1.  **Identify Suitable Task**: Determine if the task aligns with Serena's strengths.
2.  **Formulate Serena Prompt**: Craft a clear and concise prompt for Serena, specifying the desired outcome and any constraints.
3.  **Execute Serena Task**: (This would be an instruction for Claude to use Serena's MCP tools).
4.  **Validate Results**: Review Serena's output (code changes, reports, test results) and integrate them into the main development process.

---
*This file is loaded automatically by Claude Code for context*